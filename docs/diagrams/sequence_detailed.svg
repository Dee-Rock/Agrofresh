<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="1000" xmlns="http://www.w3.org/2000/svg">
    <!-- Background -->
    <rect width="100%" height="100%" fill="#ffffff"/>
    
    <!-- Title -->
    <text x="600" y="40" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold" fill="#000000">AgroFresh - Order Placement Sequence Diagram</text>
    
    <!-- Participants -->
    <rect x="50" y="80" width="200" height="40" rx="5" fill="#e6f3ff" stroke="#0066cc" stroke-width="2"/>
    <text x="150" y="107" font-family="Arial" font-weight="bold" text-anchor="middle">Buyer</text>
    
    <rect x="300" y="80" width="200" height="40" rx="5" fill="#e6ffe6" stroke="#009900" stroke-width="2"/>
    <text x="400" y="107" font-family="Arial" font-weight="bold" text-anchor="middle">Frontend</text>
    
    <rect x="550" y="80" width="200" height="40" rx="5" fill="#fff2cc" stroke="#e69138" stroke-width="2"/>
    <text x="650" y="107" font-family="Arial" font-weight="bold" text-anchor="middle">Backend</text>
    
    <rect x="800" y="80" width="200" height="40" rx="5" fill="#f4cccc" stroke="#cc0000" stroke-width="2"/>
    <text x="900" y="107" font-family="Arial" font-weight="bold" text-anchor="middle">Database</text>
    
    <rect x="1050" y="80" width="200" height="40" rx="5" fill="#e1d5e7" stroke="#674ea7" stroke-width="2"/>
    <text x="1150" y="107" font-family="Arial" font-weight="bold" text-anchor="middle">Payment Gateway</text>
    
    <!-- Lifelines -->
    <line x1="150" y1="120" x2="150" y2="950" stroke="#666666" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="400" y1="120" x2="400" y2="950" stroke="#666666" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="650" y1="120" x2="650" y2="950" stroke="#666666" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="900" y1="120" x2="900" y2="950" stroke="#666666" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="1150" y1="120" x2="1150" y2="950" stroke="#666666" stroke-width="1" stroke-dasharray="5,3"/>
    
    <!-- Activation Boxes -->
    <rect x="375" y="180" width="50" height="220" fill="#e6ffe6" fill-opacity="0.3" stroke="#009900" stroke-width="1" stroke-dasharray="3,2"/>
    <rect x="625" y="230" width="50" height="400" fill="#fff2cc" fill-opacity="0.3" stroke="#e69138" stroke-width="1" stroke-dasharray="3,2"/>
    <rect x="875" y="300" width="50" height="250" fill="#f4cccc" fill-opacity="0.3" stroke="#cc0000" stroke-width="1" stroke-dasharray="3,2"/>
    
    <!-- Messages -->
    <!-- 1. Browse Products -->
    <line x1="150" y1="150" x2="400" y2="180" stroke="#0066cc" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="275" y="170" font-family="Arial" font-size="14" text-anchor="middle">1. Browse Products</text>
    
    <!-- 2. GET /api/products -->
    <line x1="400" y1="200" x2="650" y2="230" stroke="#009900" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="525" y="220" font-family="Arial" font-size="14" text-anchor="middle">2. GET /api/products</text>
    
    <!-- 3. Query Products -->
    <line x1="650" y1="250" x2="900" y2="280" stroke="#e69138" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="775" y="270" font-family="Arial" font-size="14" text-anchor="middle">3. Query products table</text>
    
    <!-- 4. Return Product Data -->
    <line x1="900" y1="300" x2="650" y2="330" stroke="#cc0000" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="775" y="320" font-family="Arial" font-size="14" text-anchor="middle">4. Return product data</text>
    
    <!-- 5. Display Products -->
    <line x1="400" y1="350" x2="150" y2="380" stroke="#009900" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="275" y="370" font-family="Arial" font-size="14" text-anchor="middle">5. Display products</text>
    
    <!-- 6. Add to Cart -->
    <line x1="150" y1="410" x2="400" y2="440" stroke="#0066cc" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="275" y="430" font-family="Arial" font-size="14" text-anchor="middle">6. Add to Cart & Checkout</text>
    
    <!-- 7. POST /api/orders -->
    <line x1="400" y1="460" x2="650" y2="490" stroke="#009900" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="525" y="480" font-family="Arial" font-size="14" text-anchor="middle">7. POST /api/orders</text>
    
    <!-- 8. Create Order -->
    <line x1="650" y1="510" x2="900" y2="540" stroke="#e69138" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="775" y="530" font-family="Arial" font-size="14" text-anchor="middle">8. Create order record</text>
    
    <!-- 9. Order Created -->
    <line x1="900" y1="560" x2="650" y2="590" stroke="#cc0000" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="775" y="580" font-family="Arial" font-size="14" text-anchor="middle">9. Order created</text>
    
    <!-- 10. Process Payment -->
    <line x1="650" y1="630" x2="1150" y2="700" stroke="#e69138" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="900" y="670" font-family="Arial" font-size="14" text-anchor="middle">10. Initialize payment</text>
    
    <!-- 11. Payment Processing -->
    <rect x="1050" y="710" width="200" height="80" rx="5" fill="#f0f0f0" stroke="#674ea7" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="1150" y="740" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Payment Processing</text>
    <text x="1150" y="760" font-family="Arial" font-size="10" text-anchor="middle">(External Process)</text>
    
    <!-- 12. Payment Success -->
    <line x1="1150" y1="790" x2="650" y2="860" stroke="#674ea7" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="900" y="830" font-family="Arial" font-size="14" text-anchor="middle">11. Payment success webhook</text>
    
    <!-- 13. Update Order Status -->
    <line x1="650" y1="890" x2="900" y2="920" stroke="#e69138" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="775" y="910" font-family="Arial" font-size="14" text-anchor="middle">12. Update order status</text>
    
    <!-- 14. Send Confirmation -->
    <line x1="400" y1="950" x2="150" y2="980" stroke="#009900" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="275" y="970" font-family="Arial" font-size="14" text-anchor="middle">13. Send order confirmation</text>
    
    <!-- Arrow markers -->
    <defs>
        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#000000"/>
        </marker>
        <marker id="dashed-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#000000"/>
        </marker>
    </defs>
    
    <!-- Notes -->
    <rect x="50" y="800" width="300" height="100" rx="5" fill="#ffffcc" stroke="#cccc99" stroke-width="1"/>
    <text x="60" y="820" font-family="Arial" font-size="12" font-weight="bold">Note:</text>
    <text x="60" y="840" font-family="Arial" font-size="12">1. This sequence shows the happy path</text>
    <text x="60" y="860" font-family="Arial" font-size="12">2. Error handling and edge cases</text>
    <text x="60" y="880" font-family="Arial" font-size="12">   are not shown for simplicity</text>
    
    <!-- Legend -->
    <rect x="800" y="800" width="350" height="120" rx="5" fill="#f0f0f0" stroke="#cccccc" stroke-width="1"/>
    <text x="975" y="820" font-family="Arial" font-weight="bold" text-anchor="middle">Legend</text>
    
    <line x1="820" y1="840" x2="850" y2="840" stroke="#0066cc" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="870" y="845" font-family="Arial" font-size="12">Synchronous message</text>
    
    <line x1="820" y1="870" x2="850" y2="870" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#dashed-arrow)"/>
    <text x="870" y="875" font-family="Arial" font-size="12">Asynchronous message</text>
    
    <rect x="820" y="890" width="20" height="30" rx="2" fill="#e6ffe6" fill-opacity="0.3" stroke="#009900" stroke-width="1" stroke-dasharray="3,2"/>
    <text x="870" y="910" font-family="Arial" font-size="12">Activation (focus of control)</text>
    
    <rect x="820" y="920" width="15" height="15" rx="2" fill="#f0f0f0" stroke="#666666" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="870" y="932" font-family="Arial" font-size="12">External process</text>
</svg>
